#  AnotherSearchEngine (ещё один поисковый движок)

Реализация поискового движка, который осуществляет:  
-  обход всех страниц заданных сайтов;
-  индексацию найденных страниц;
-  выдачу наиболее релевантных страниц заданных сайтов по поисковому запросу на русском и английском языках.

##  Стек используемых технологий  
-  разработка: Java 13.0.2, Spring Boot 2.3.9;  
-  сборка: Maven 3.6.3;  
-  база данных: MySQL 8.0.22;  
-  API: REST;  
-  система контроля версий: Git 2.27.0.

##  Использование сторонних проектов  

###  Frontend  
К приложению подключена frontend-составляющая, которая представляет собой веб-страницу.
Данная веб-страница была разработана отдельно, оригинал её кода находится в репозитории по [ссылке](https://github.com/skillbox-java/search_engine_frontend). Вариант веб-страницы, доработанной под данный проект находится в репозитории проекта в папке `/src/main/resources/static/`, [ссылка](https://github.com/Alexander-ILIN/another-search-engine/tree/master/src/main/resources/static).  

---  

###  Лемматизатор  
Лемматизатор — это специальная библиотека, которая позволяет получать леммы слов - их исходные формы (для существительных, например, это слово в именительном падеже и единственном числе).  
К проекту подключен лемматизатор для русского и английского языков, [ссылка](https://github.com/AKuznetsov/russianmorphology).  

##  Описание  

###  Работа приложения  

-  вкладка `DASHBOARD`  
Эта вкладка открывается по умолчанию. На ней отображается общая статистика по всем сайтам:  

   -  количество сайтов, указанных в файле конфигрурации;  
   -  количество страниц по всем проиндексированным сайтам;  
   -  количество лемм по всем проиндексированным сайтам;  
   -  список всех сайтов, указанных в файле конфигрурации, а также их статус.  

   Возможные статусы сайтов:

   -  `INDEXING` - индексация сайта не была ни разу запущена, либо находится в процессе;  
   -  `INDEXED` - сайт удачно проиндексирован;  
   -  `FAILED` - индексация сайта была остановлена, либо завершилась ошибкой.  
      
   Также для каждого сайта из списка доступна детальная статистика:  
   
   -  время последнего изменения статуса;  
   -  количество страниц;
   -  количество лемм;  
   -  последняя ошибка при индексации (если статус `FAILED`).

   ![DASHBOARD](/images/Dashboard.png)

-  вкладка `MANAGEMENT`  
На этой вкладке находятся инструменты управления индексацией.  
Возможные действия:  

   -  запуск индексации / переиндексации всех сайтов из файла конфигурации; для этого в выпадающем списке необходимо выбрать / оставить `All sites` и нажать кнопку `START INDEXING`;  
   -  запуск индексации / переиндексации одного сайта; для этого в выпадающем списке необходимо выбрать сайт и нажать кнопку `START INDEXING`;
   -  остановка процесса индексации; для этого необходимо нажать кнопку `STOP INDEXING`;  
   -  добавление / обновление отдельной страницы; для этого необходимо вставить ссылку в поле `Add/update page` и нажать кнопку `ADD/UPDATE`; выполнение данного действия доступно только в случае, если добавляемая / обновляемая страница относится к одному из сайтов списка.

   ![MANAGEMENT](/images/Management.png)


-  Вкладка `SEARCH`  
Вкладка поиска. Для осуществления поиска необходимо в выпадющем списке выбрать сайт, по которому искать, либо оставить `All sites` для поиска по всем сайтам и ввести поисковый запрос в поле `Query`. После нажатия на кнопку `SEARCH` будут выведены результаты поиска.  

   ![SEARCH](/images/Search.png)

---


###  API

-  Запуск индексации - ***GET*** `/startIndexing`  
**Параметры:**  
   -  *site - сайт, который необходимо проиндексировать (если не задан, происходит индексация всех сайтов, указанных в конфигурационном файле); задаётся в формате адреса, например: http://www.site.com;*  
   
   **Формат ответа в случае успеха:**  

       {'result': true}
        
      **Формат ответа в случае ошибки:**  

       {'result': false,
       'error': "Индексация уже запущена"}

-  Остановка текущей индексации - ***GET*** `/stopIndexing`  
**Параметры:**  
*Метод без параметров.*  
**Формат ответа в случае успеха:**  

       {'result': true}

      **Формат ответа в случае ошибки:**  

       {'result': false,
       'error': "Индексация не запущена"}

-  Добавление или обновление отдельной страницы - ***POST*** `/indexPage`  
**Параметры:**  
   -  *url - адрес страницы, которую нужно переиндексировать.*  

   **Формат ответа в случае успеха:**  

       {'result': true}

   **Формат ответа в случае ошибки:**  

       {'result': false,
       'error': "Данная страница находится за пределами сайтов, указанных в конфигурационном файле"}

-  Статистика - ***GET*** `/statistics`  
**Параметры:**  
*Метод без параметров.*  
**Формат ответа:**  

       {'result': true,
       'statistics':
              {"total":
                     {"sites": 10,
                     "pages": 436423,
                     "lemmas": 5127891,
                     "isIndexing": true},
              "detailed":
                     [{"url": "http://www.site.com",
                     "name": "Имя сайта",
                     "status": "INDEXED",
                     "statusTime": 1600160357,
                     "error": "Ошибка индексации: главная страница сайта недоступна",
                     "pages": 5764,
                     "lemmas": 321115},
                     ...
                     ]
              }
       }

-  Получение данных по поисковому запросу - ***GET*** `/search`  
**Параметры:**  
   -  *query - поисковый запрос;*  
   -  *site - сайт, по которому осуществлять поиск (если не задан, поиск должен происходить по всем проиндексированным сайтам); задаётся в формате адреса, например: http://www.site.com (без слэша в конце);*  
   -  *offset - сдвиг от 0 для постраничного вывода (параметр необязательный, если не установлен, то значение по умолчанию равно нулю);*  
   -  *limit - количество результатов, которое необходимо вывести (параметр необязательный, если не установлен, то значение по умолчанию равно 20-ти).*  
   
   **Формат ответа в случае успеха:**   

       {'result': true,
       'count': 574,
       'data':
              [{"site": "http://www.site.com",
              "siteName": "Имя сайта",
              "uri": "/path/to/page/6784",
              "title": "Заголовок страницы,которую выводим",
              "snippet": "Фрагмент текста, в котором найдены совпадения, <b>выделенные жирным</b>, в формате HTML",
              "relevance": 0.93362},
              ...
              ]
       }

   **Формат ответа в случае ошибки:**  

       {'result': false,
       'error': "Задан пустой поисковый запрос"}

---  


###  Конфигурационный файл (application.yaml)
Конфигурационный файл содержит:  

-  пользовательские переменные - `variables`:

   -  префикс имён таблиц - `tablesPrefix`;  
   -  перечень сайтов, которые необходимо индексировать - `sites`; для каждого сайта задаются адрес - `url` и имя - `name`;
   -  имя user-agent, который необходимо подставлять при запросах страниц сайтов - `userAgent`;
   -  referrer, который необходимо подставлять при запросах страниц сайтов - `referrer`;
   -  размер буфера, использующегося при сохранении страниц - `pageBufferSize`;
   -  размер буфера, использующегося при сохранении лемм - `lemmaBufferSize`;
   -  размер буфера, использующегося при сохранении поисковых индексов - `indexBufferSize`;
   
-  путь к веб-интерфейсу - `server.servlet.context-path`;
-  свойства подключения к базе данных: хост, имя базы - `spring.datasource.url`;
-  свойства подключения к базе данных: логин - `spring.datasource.username`;
-  свойства подключения к базе данных: пароль - `spring.datasource.password`;
-  режим управления структурой базы данных - `spring.jpa.hibernate.ddl-auto`.

Пример заполненного файла application.yaml:  

    variables:
    
      # Префикс имён таблиц
      tablesPrefix: ase_
      
      # Перечень сайтов
      sites:
        - url: https://dombulgakova.ru/
        name: Дом Булгакова
        - url: https://www.svetlovka.ru/
        name: Библиотека имени М. А. Светлова
        
      #Свойства User Agent
      userAgent: another search engine bot
      referrer: http://www.google.com
      
      # Размер буферов для сохранения в БД
      pageBufferSize: 100
      lemmaBufferSize: 1000
      indexBufferSize: 5000
    
    #Путь к веб-интерфейсу
    server.servlet.context-path: /admin
    
    # Свойства подключения к БД
    spring.datasource.url: jdbc:mysql://127.0.0.1:3306/search_engine_db
    spring.datasource.username: bestuser
    spring.datasource.password: bestuser
    
    #Режим работы БД (create - для создания таблиц в БД, none - для обычной работы приложения)
    spring.jpa.hibernate.ddl-auto: none
    
---  

###  Таблицы в базе данных

-  **field** -   
-  **index** -   
-  **lemma** -   
-  **page** - информация о страницах сайтов;  
   -  id INT NOT NULL AUTO_INCREMENT;  
   -  path TEXT NOT NULL - адрес страницы от корня сайта (должен начинаться со слеша, например: /news/372189/);
   -  code INT NOT NULL - код ответа, полученный при запросе страницы (например, 200, 404, 500 или другие);
   -  content MEDIUMTEXT NOT NULL - контент страницы (HTML-код).
-  **site** -   


##  Запуск проекта локально
